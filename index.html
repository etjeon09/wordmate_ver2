<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Wordmate - ë‚˜ë§Œì˜ ìŠ¤ë§ˆíŠ¸ ë‹¨ì–´ì¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Noto Sans KR', sans-serif; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .quiz-option:hover { transform: translateY(-2px); transition: all 0.2s; }
        .word-card { transition: all 0.3s ease; }
        .word-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- ë¡œê·¸ì¸ ëª¨ë‹¬ -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">ğŸ” My Wordmate ë¡œê·¸ì¸</h2>
            
            <!-- ë¡œê·¸ì¸ í¼ -->
            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">ì‚¬ìš©ìëª…</label>
                    <input type="text" id="loginUsername" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-all" placeholder="ì‚¬ìš©ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="loginPassword" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-all" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <button type="submit" class="w-full bg-blue-500 text-white font-bold py-3 px-6 rounded-xl hover:bg-blue-600 transition-all">
                    ë¡œê·¸ì¸
                </button>
            </form>
            
            <div class="text-center mt-4">
                <button onclick="showRegisterForm()" class="text-blue-500 hover:text-blue-700 text-sm">
                    ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”? íšŒì›ê°€ì…
                </button>
            </div>
            
            <div id="loginMessage" class="mt-4 text-center text-sm"></div>
        </div>
    </div>

    <!-- íšŒì›ê°€ì… ëª¨ë‹¬ -->
    <div id="registerModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">ğŸ“ íšŒì›ê°€ì…</h2>
            
            <!-- íšŒì›ê°€ì… í¼ -->
            <form id="registerForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">ì‚¬ìš©ìëª…</label>
                    <input type="text" id="registerUsername" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-all" placeholder="ì‚¬ìš©ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                    <div id="usernameCheck" class="text-xs mt-1"></div>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="registerPassword" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-all" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš” (6ì ì´ìƒ)" required>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                    <input type="password" id="registerPasswordConfirm" class="w-full p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-all" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”" required>
                </div>
                <button type="submit" class="w-full bg-green-500 text-white font-bold py-3 px-6 rounded-xl hover:bg-green-600 transition-all">
                    íšŒì›ê°€ì…
                </button>
            </form>
            
            <div class="text-center mt-4">
                <button onclick="showLoginForm()" class="text-blue-500 hover:text-blue-700 text-sm">
                    ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? ë¡œê·¸ì¸
                </button>
            </div>
            
            <div id="registerMessage" class="mt-4 text-center text-sm"></div>
        </div>
    </div>

    <!-- ì–¸ì–´ ì„ íƒ ëª¨ë‹¬ -->
    <div id="languageModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">í•™ìŠµí•  ì–¸ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”</h2>
            <div class="grid grid-cols-3 gap-3">
                <button onclick="selectLanguage('en', 'English')" class="p-3 border-2 border-blue-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all">
                    <div class="text-xl mb-1">ğŸ‡ºğŸ‡¸</div>
                    <div class="font-semibold text-sm">English</div>
                </button>
                <button onclick="selectLanguage('es', 'EspaÃ±ol')" class="p-3 border-2 border-blue-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all">
                    <div class="text-xl mb-1">ğŸ‡ªğŸ‡¸</div>
                    <div class="font-semibold text-sm">EspaÃ±ol</div>
                </button>
                <button onclick="selectLanguage('fr', 'FranÃ§ais')" class="p-3 border-2 border-blue-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all">
                    <div class="text-xl mb-1">ğŸ‡«ğŸ‡·</div>
                    <div class="font-semibold text-sm">FranÃ§ais</div>
                </button>
                <button onclick="selectLanguage('de', 'Deutsch')" class="p-3 border-2 border-blue-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all">
                    <div class="text-xl mb-1">ğŸ‡©ğŸ‡ª</div>
                    <div class="font-semibold text-sm">Deutsch</div>
                </button>
                <button onclick="selectLanguage('ja', 'æ—¥æœ¬èª')" class="p-3 border-2 border-blue-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all">
                    <div class="text-xl mb-1">ğŸ‡¯ğŸ‡µ</div>
                    <div class="font-semibold text-sm">æ—¥æœ¬èª</div>
                </button>
                <button onclick="selectLanguage('zh', 'ä¸­æ–‡')" class="p-3 border-2 border-blue-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all">
                    <div class="text-xl mb-1">ğŸ‡¨ğŸ‡³</div>
                    <div class="font-semibold text-sm">ä¸­æ–‡</div>
                </button>
                <button onclick="selectLanguage('it', 'Italiano')" class="p-3 border-2 border-blue-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all">
                    <div class="text-xl mb-1">ğŸ‡®ğŸ‡¹</div>
                    <div class="font-semibold text-sm">Italiano</div>
                </button>
                <button onclick="selectLanguage('pt', 'PortuguÃªs')" class="p-3 border-2 border-blue-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all">
                    <div class="text-xl mb-1">ğŸ‡µğŸ‡¹</div>
                    <div class="font-semibold text-sm">PortuguÃªs</div>
                </button>
                <button onclick="selectLanguage('ru', 'Ğ ÑƒÑÑĞºĞ¸Ğ¹')" class="p-3 border-2 border-blue-200 rounded-xl hover:border-blue-500 hover:bg-blue-50 transition-all">
                    <div class="text-xl mb-1">ğŸ‡·ğŸ‡º</div>
                    <div class="font-semibold text-sm">Ğ ÑƒÑÑĞºĞ¸Ğ¹</div>
                </button>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- í—¤ë” -->
        <div class="text-center mb-8">
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-center gap-3">
                    <span class="text-gray-600">ğŸ‘¤ <span id="currentUserDisplay" class="font-semibold"></span></span>
                    <button onclick="logout()" class="text-red-500 hover:text-red-700 text-sm">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="showUserSwitch()" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-1 rounded-lg text-sm transition-all">
                        ğŸ”„ ì‚¬ìš©ì ì „í™˜
                    </button>
                </div>
            </div>
            <div class="inline-flex items-center gap-3 bg-gradient-to-r from-purple-600 via-blue-600 to-indigo-600 bg-clip-text text-transparent mb-4">
                <div class="text-5xl">ğŸ“–</div>
                <h1 class="text-5xl font-black tracking-tight">My Wordmate</h1>
                <div class="text-5xl">âœ¨</div>
            </div>
            <p class="text-gray-600 text-lg">ë‹¹ì‹ ë§Œì˜ ìŠ¤ë§ˆíŠ¸ ë‹¨ì–´ í•™ìŠµ íŒŒíŠ¸ë„ˆ</p>
            <p class="text-gray-500 text-sm mt-2">ì„ íƒí•œ ì–¸ì–´: <span id="selectedLanguage" class="font-semibold text-blue-600"></span></p>
        </div>

        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="flex flex-wrap justify-center mb-8 bg-white rounded-2xl p-2 shadow-lg">
            <button onclick="showTab('add')" id="addTab" class="tab-btn px-6 py-3 rounded-xl font-semibold transition-all bg-blue-500 text-white">ë‹¨ì–´ ì¶”ê°€</button>
            <button onclick="showTab('list')" id="listTab" class="tab-btn px-6 py-3 rounded-xl font-semibold transition-all text-gray-600 hover:bg-gray-100">ë‹¨ì–´ ëª©ë¡</button>
            <button onclick="showTab('quiz')" id="quizTab" class="tab-btn px-6 py-3 rounded-xl font-semibold transition-all text-gray-600 hover:bg-gray-100">í€´ì¦ˆ</button>
            <button onclick="showTab('hardQuiz')" id="hardQuizTab" class="tab-btn px-6 py-3 rounded-xl font-semibold transition-all text-gray-600 hover:bg-gray-100">ê³ ê¸‰ í€´ì¦ˆ</button>
        </div>

        <!-- ë‹¨ì–´ ì¶”ê°€ íƒ­ -->
        <div id="addSection" class="tab-content">
            <div class="bg-white rounded-2xl shadow-xl p-8 mb-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6">ìƒˆ ë‹¨ì–´ ì¶”ê°€</h2>
                <form id="wordForm" class="space-y-6">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ë‹¨ì–´</label>
                            <input type="text" id="wordInput" class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-all" placeholder="ìƒˆë¡œìš´ ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">ëœ» (í•œêµ­ì–´)</label>
                            <input type="text" id="meaningInput" class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-all" placeholder="ë‹¨ì–´ì˜ ëœ»ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">ì˜ˆë¬¸</label>
                        <textarea id="exampleInput" class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-all h-24" placeholder="ì˜ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>

                    <button type="submit" class="w-full bg-gradient-to-r from-blue-500 to-indigo-600 text-white font-bold py-4 px-8 rounded-xl hover:from-blue-600 hover:to-indigo-700 transition-all transform hover:scale-105 shadow-lg">
                        ğŸ“ ë‹¨ì–´ ì¶”ê°€í•˜ê¸°
                    </button>
                </form>
            </div>
        </div>

        <!-- ë‹¨ì–´ ëª©ë¡ íƒ­ -->
        <div id="listSection" class="tab-content hidden">
            <div class="bg-white rounded-2xl shadow-xl p-8">
                <div class="flex flex-wrap justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">ë‹¨ì–´ ëª©ë¡</h2>
                    <div class="flex gap-4 mt-4 md:mt-0">
                        <input type="date" id="dateFilter" class="p-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none">
                        <button onclick="filterByDate()" class="bg-blue-500 text-white px-6 py-3 rounded-xl hover:bg-blue-600 transition-all">ë‚ ì§œë³„ ë³´ê¸°</button>
                        <button onclick="showAllWords()" class="bg-gray-500 text-white px-6 py-3 rounded-xl hover:bg-gray-600 transition-all">ì „ì²´ ë³´ê¸°</button>
                    </div>
                </div>
                <div id="wordsList" class="space-y-4">
                    <p class="text-gray-500 text-center py-8">ì•„ì§ ì¶”ê°€ëœ ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>

        <!-- í€´ì¦ˆ íƒ­ -->
        <div id="quizSection" class="tab-content hidden">
            <div class="bg-white rounded-2xl shadow-xl p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">ê°ê´€ì‹ í€´ì¦ˆ</h2>
                <div id="quizContent">
                    <p class="text-gray-500 text-center py-8">í€´ì¦ˆë¥¼ ì‹œì‘í•˜ë ¤ë©´ ìµœì†Œ 4ê°œì˜ ë‹¨ì–´ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
                    <button onclick="startQuiz()" class="w-full bg-green-500 text-white font-bold py-4 px-8 rounded-xl hover:bg-green-600 transition-all transform hover:scale-105 shadow-lg">
                        ğŸ¯ í€´ì¦ˆ ì‹œì‘í•˜ê¸°
                    </button>
                </div>
            </div>
        </div>

        <!-- ê³ ê¸‰ í€´ì¦ˆ íƒ­ -->
        <div id="hardQuizSection" class="tab-content hidden">
            <div class="bg-white rounded-2xl shadow-xl p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">ì£¼ê´€ì‹ í€´ì¦ˆ</h2>
                <div id="hardQuizContent">
                    <p class="text-gray-500 text-center py-8">ê³ ê¸‰ í€´ì¦ˆë¥¼ ì‹œì‘í•˜ë ¤ë©´ ìµœì†Œ 1ê°œì˜ ë‹¨ì–´ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
                    <button onclick="startHardQuiz()" class="w-full bg-purple-500 text-white font-bold py-4 px-8 rounded-xl hover:bg-purple-600 transition-all transform hover:scale-105 shadow-lg">
                        ğŸ§  ê³ ê¸‰ í€´ì¦ˆ ì‹œì‘í•˜ê¸°
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentLanguage = '';
        let currentUser = '';
        let words = [];
        let currentQuizWord = null;
        let currentHardQuizWord = null;
        let quizWordPool = [];
        let hardQuizWordPool = [];
        let quizRound = 1;
        let hardQuizRound = 1;
        let hardQuizScore = 0;
        let hardQuizTotal = 0;
        let roundScores = [];
        let currentRoundWrongAnswers = [];

        // ë¹„ë°€ë²ˆí˜¸ í•´ì‹œ í•¨ìˆ˜ (ê°„ë‹¨í•œ í•´ì‹œ)
        function simpleHash(str) {
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash; // 32bit ì •ìˆ˜ë¡œ ë³€í™˜
            }
            return hash.toString();
        }

        // ì‚¬ìš©ìëª… ì¤‘ë³µ ì²´í¬
        function checkUsernameAvailability(username) {
            const users = JSON.parse(localStorage.getItem('appUsers') || '{}');
            return !users.hasOwnProperty(username);
        }

        // ì‚¬ìš©ì ë“±ë¡
        function registerUser(username, password) {
            if (!checkUsernameAvailability(username)) {
                return { success: false, message: 'ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ìëª…ì…ë‹ˆë‹¤.' };
            }
            
            if (password.length < 6) {
                return { success: false, message: 'ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.' };
            }
            
            // ë¹„ë°€ë²ˆí˜¸ í•´ì‹œí™”
            const passwordHash = simpleHash(password);
            
            // ì‚¬ìš©ì ì •ë³´ ì €ì¥
            const users = JSON.parse(localStorage.getItem('appUsers') || '{}');
            users[username] = {
                passwordHash: passwordHash,
                createdAt: new Date().toISOString(),
                lastLogin: new Date().toISOString()
            };
            
            localStorage.setItem('appUsers', JSON.stringify(users));
            
            // ì‚¬ìš©ìë³„ ë°ì´í„° ì´ˆê¸°í™”
            localStorage.setItem(`userData_${username}`, JSON.stringify({
                words: [],
                quizResults: [],
                roundScores: [],
                settings: { language: '' }
            }));
            
            return { success: true };
        }

        // ì‚¬ìš©ì ë¡œê·¸ì¸
        function loginUser(username, password) {
            const users = JSON.parse(localStorage.getItem('appUsers') || '{}');
            const user = users[username];
            
            if (!user) {
                return { success: false, message: 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ìëª…ì…ë‹ˆë‹¤.' };
            }
            
            const passwordHash = simpleHash(password);
            if (user.passwordHash !== passwordHash) {
                return { success: false, message: 'ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.' };
            }
            
            // ë¡œê·¸ì¸ ì„±ê³µ
            user.lastLogin = new Date().toISOString();
            localStorage.setItem('appUsers', JSON.stringify(users));
            
            // í˜„ì¬ ì‚¬ìš©ì ì„¤ì •
            currentUser = username;
            localStorage.setItem('currentUser', username);
            
            // ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ
            loadUserData(username);
            
            return { success: true };
        }

        // ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ
        function loadUserData(username) {
            const userData = JSON.parse(localStorage.getItem(`userData_${username}`) || '{}');
            words = userData.words || [];
            roundScores = userData.roundScores || [];
            
            // ì–¸ì–´ ì„¤ì • ë¡œë“œ
            if (userData.settings && userData.settings.language) {
                currentLanguage = userData.settings.language;
                const savedLanguage = JSON.parse(localStorage.getItem('selectedLanguage') || 'null');
                if (savedLanguage) {
                    document.getElementById('selectedLanguage').textContent = savedLanguage.name;
                }
            }
            
            // UI ì—…ë°ì´íŠ¸
            document.getElementById('currentUserDisplay').textContent = username;
            displayWords();
        }

        // ì‚¬ìš©ì ë°ì´í„° ì €ì¥
        function saveUserData() {
            if (!currentUser) return;
            
            const userData = {
                words: words,
                roundScores: roundScores,
                settings: { 
                    language: currentLanguage 
                }
            };
            localStorage.setItem(`userData_${currentUser}`, JSON.stringify(userData));
        }

        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            if (confirm('ì •ë§ë¡œ ë¡œê·¸ì•„ì›ƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                saveUserData();
                currentUser = '';
                currentLanguage = '';
                words = [];
                roundScores = [];
                localStorage.removeItem('currentUser');
                
                // ë¡œê·¸ì¸ ëª¨ë‹¬ í‘œì‹œ
                document.getElementById('loginModal').classList.remove('hidden');
                document.getElementById('currentUserDisplay').textContent = '';
                document.getElementById('selectedLanguage').textContent = '';
                displayWords();
            }
        }

        // ì‚¬ìš©ì ì „í™˜
        function showUserSwitch() {
            const users = JSON.parse(localStorage.getItem('appUsers') || '{}');
            const userList = Object.keys(users);
            
            if (userList.length <= 1) {
                showMessage('ì „í™˜í•  ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            const switchUser = prompt('ì „í™˜í•  ì‚¬ìš©ìëª…ì„ ì…ë ¥í•˜ì„¸ìš”:\n\nì‚¬ìš© ê°€ëŠ¥í•œ ì‚¬ìš©ì: ' + userList.join(', '));
            
            if (switchUser && userList.includes(switchUser)) {
                saveUserData();
                currentUser = switchUser;
                localStorage.setItem('currentUser', switchUser);
                loadUserData(switchUser);
                showMessage(`${switchUser} ì‚¬ìš©ìë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');
            }
        }

        // ëª¨ë‹¬ ì „í™˜ í•¨ìˆ˜ë“¤
        function showRegisterForm() {
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('registerModal').classList.remove('hidden');
        }

        function showLoginForm() {
            document.getElementById('registerModal').classList.add('hidden');
            document.getElementById('loginModal').classList.remove('hidden');
        }

        // ì–¸ì–´ ì„ íƒ
        function selectLanguage(code, name) {
            currentLanguage = code;
            document.getElementById('selectedLanguage').textContent = name;
            document.getElementById('languageModal').classList.add('hidden');
            localStorage.setItem('selectedLanguage', JSON.stringify({code, name}));
            
            // ì‚¬ìš©ì ì„¤ì •ì— ì–¸ì–´ ì €ì¥
            if (currentUser) {
                saveUserData();
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            // ê¸°ì¡´ ì‚¬ìš©ì í™•ì¸
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = savedUser;
                loadUserData(savedUser);
                document.getElementById('loginModal').classList.add('hidden');
            } else {
                // ë¡œê·¸ì¸ ëª¨ë‹¬ í‘œì‹œ
                document.getElementById('loginModal').classList.remove('hidden');
            }
        };

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ ì½˜í…ì¸  ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('bg-blue-500', 'text-white');
                btn.classList.add('text-gray-600');
            });
            
            // ì„ íƒëœ íƒ­ í‘œì‹œ
            document.getElementById(tabName + 'Section').classList.remove('hidden');
            document.getElementById(tabName + 'Tab').classList.add('bg-blue-500', 'text-white');
            document.getElementById(tabName + 'Tab').classList.remove('text-gray-600');
        }

        // ë‹¨ì–´ ì¶”ê°€
        document.getElementById('wordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const word = document.getElementById('wordInput').value.trim();
            const meaning = document.getElementById('meaningInput').value.trim();
            const example = document.getElementById('exampleInput').value.trim();
            
            if (!word || !meaning) return;
            
            const newWord = {
                id: Date.now(),
                word: word,
                meaning: meaning,
                example: example,
                date: new Date().toISOString().split('T')[0],
                language: currentLanguage
            };
            
            saveWord(newWord);
        });

        function saveWord(word) {
            words.push(word);
            saveUserData();
            
            // í¼ ì´ˆê¸°í™”
            document.getElementById('wordForm').reset();
            
            // ì„±ê³µ ë©”ì‹œì§€
            showMessage('ë‹¨ì–´ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰', 'success');
            
            // ëª©ë¡ ì—…ë°ì´íŠ¸
            displayWords();
        }

        // ë‹¨ì–´ ëª©ë¡ í‘œì‹œ
        function displayWords(filteredWords = null) {
            const wordsToShow = filteredWords || words;
            const wordsList = document.getElementById('wordsList');
            
            if (wordsToShow.length === 0) {
                wordsList.innerHTML = '<p class="text-gray-500 text-center py-8">í‘œì‹œí•  ë‹¨ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            wordsList.innerHTML = wordsToShow.map(word => `
                <div class="word-card bg-gray-50 rounded-xl p-6 border-2 border-gray-200">
                    <div class="flex flex-wrap items-start justify-between gap-4">
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-3 mb-3">
                                <h3 class="text-xl font-bold text-gray-800">${word.word}</h3>
                                <button onclick="speakWord(\`${word.word}\`)" class="bg-blue-100 hover:bg-blue-200 text-blue-600 p-2 rounded-lg transition-all" title="ë°œìŒ ë“£ê¸°">
                                    ğŸ”Š
                                </button>
                            </div>
                            <p class="text-gray-600 mb-2"><strong>ëœ»:</strong> ${word.meaning}</p>
                            ${word.example ? `<p class="text-gray-600 mb-2"><strong>ì˜ˆë¬¸:</strong> ${word.example}</p>` : ''}
                            <p class="text-sm text-gray-400">ì¶”ê°€ì¼: ${word.date}</p>
                        </div>

                        <div class="flex gap-2">
                            <button onclick="editWord(${word.id})" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition-all">ìˆ˜ì •</button>
                            <button onclick="deleteWord(${word.id})" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-all">ì‚­ì œ</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ë°œìŒ ê¸°ëŠ¥
        function speakWord(word) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = getLanguageCode(currentLanguage);
                speechSynthesis.speak(utterance);
            } else {
                showMessage('ìŒì„± ê¸°ëŠ¥ì„ ì§€ì›í•˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤.', 'error');
            }
        }

        function getLanguageCode(lang) {
            const codes = {
                'en': 'en-US',
                'es': 'es-ES',
                'fr': 'fr-FR',
                'de': 'de-DE',
                'ja': 'ja-JP',
                'zh': 'zh-CN',
                'it': 'it-IT',
                'pt': 'pt-PT',
                'ru': 'ru-RU'
            };
            return codes[lang] || 'en-US';
        }

        // ë‹¨ì–´ ì‚­ì œ
        function deleteWord(id) {
            if (confirm('ì •ë§ë¡œ ì´ ë‹¨ì–´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                words = words.filter(word => word.id !== id);
                saveUserData();
                displayWords();
                showMessage('ë‹¨ì–´ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            }
        }

        // ë‹¨ì–´ ìˆ˜ì •
        function editWord(id) {
            const word = words.find(w => w.id === id);
            if (!word) return;
            
            const newWord = prompt('ìƒˆë¡œìš´ ë‹¨ì–´:', word.word);
            const newMeaning = prompt('ìƒˆë¡œìš´ ëœ»:', word.meaning);
            
            if (newWord && newMeaning) {
                word.word = newWord.trim();
                word.meaning = newMeaning.trim();
                saveUserData();
                displayWords();
                showMessage('ë‹¨ì–´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            }
        }

        // ë‚ ì§œë³„ í•„í„°ë§
        function filterByDate() {
            const selectedDate = document.getElementById('dateFilter').value;
            if (!selectedDate) {
                showMessage('ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            const filteredWords = words.filter(word => word.date === selectedDate);
            displayWords(filteredWords);
        }

        // ì „ì²´ ë‹¨ì–´ ë³´ê¸°
        function showAllWords() {
            document.getElementById('dateFilter').value = '';
            displayWords();
        }

        // ê°ê´€ì‹ í€´ì¦ˆ ì‹œì‘
        function startQuiz() {
            if (words.length < 4) {
                showMessage('í€´ì¦ˆë¥¼ ì‹œì‘í•˜ë ¤ë©´ ìµœì†Œ 4ê°œì˜ ë‹¨ì–´ê°€ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            // ìƒˆë¡œìš´ ë¼ìš´ë“œ ì‹œì‘ ì‹œ ë‹¨ì–´ í’€ ì´ˆê¸°í™”
            if (quizWordPool.length === 0) {
                quizWordPool = [...words];
                quizRound = 1;
            }
            
            // ëœë¤í•˜ê²Œ ë‹¨ì–´ ì„ íƒí•˜ê³  í’€ì—ì„œ ì œê±°
            const randomIndex = Math.floor(Math.random() * quizWordPool.length);
            currentQuizWord = quizWordPool.splice(randomIndex, 1)[0];
            
            // ëª¨ë“  ë‹¨ì–´ë¥¼ ë‹¤ ì‚¬ìš©í–ˆìœ¼ë©´ ìƒˆ ë¼ìš´ë“œ ì‹œì‘
            if (quizWordPool.length === 0) {
                quizRound++;
                quizWordPool = [...words];
            }
            
            const wrongAnswers = words.filter(w => w.id !== currentQuizWord.id)
                .sort(() => 0.5 - Math.random())
                .slice(0, 3);
            
            const allOptions = [currentQuizWord, ...wrongAnswers].sort(() => 0.5 - Math.random());
            
            document.getElementById('quizContent').innerHTML = `
                <div class="text-center mb-8">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-sm text-gray-500">ë¼ìš´ë“œ ${quizRound}</div>
                        <div class="text-sm text-gray-500">ë‚¨ì€ ë¬¸ì œ: ${quizWordPool.length + 1}</div>
                    </div>
                    <div class="flex items-center justify-center gap-3 mb-4">
                        <h3 class="text-3xl font-bold text-gray-800">${currentQuizWord.word}</h3>
                        <button onclick="speakWord('${currentQuizWord.word}')" class="bg-blue-100 hover:bg-blue-200 text-blue-600 p-3 rounded-lg transition-all">
                            ğŸ”Š
                        </button>
                    </div>
                    <p class="text-gray-600 mb-8">ë‹¤ìŒ ë‹¨ì–´ì˜ ëœ»ì„ ê³ ë¥´ì„¸ìš”:</p>
                    <div class="grid gap-4 max-w-2xl mx-auto">
                        ${allOptions.map(option => `
                            <button onclick="checkAnswer('${option.meaning}', '${currentQuizWord.meaning}')" 
                                    class="quiz-option p-4 bg-gray-100 hover:bg-blue-100 rounded-xl text-left transition-all border-2 border-transparent hover:border-blue-300">
                                ${option.meaning}
                            </button>
                        `).join('')}
                    </div>
                </div>
                <div id="quizResult" class="text-center mt-6"></div>
                <button onclick="startQuiz()" class="w-full bg-green-500 text-white font-bold py-4 px-8 rounded-xl hover:bg-green-600 transition-all mt-6">
                    ğŸ”„ ë‹¤ìŒ ë¬¸ì œ
                </button>
            `;
        }

        // ë‹µì•ˆ í™•ì¸
        function checkAnswer(selected, correct) {
            const result = document.getElementById('quizResult');
            if (selected === correct) {
                result.innerHTML = '<div class="text-green-600 font-bold text-xl">ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!</div>';
            } else {
                result.innerHTML = `<div class="text-red-600 font-bold text-xl">âŒ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”<br><small class="text-gray-600">ì •ë‹µ: ${correct}</small></div>`;
            }
        }

        // ì£¼ê´€ì‹ í€´ì¦ˆ ì‹œì‘
        function startHardQuiz() {
            if (words.length === 0) {
                showMessage('í€´ì¦ˆë¥¼ ì‹œì‘í•˜ë ¤ë©´ ìµœì†Œ 1ê°œì˜ ë‹¨ì–´ê°€ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            // ìƒˆë¡œìš´ í€´ì¦ˆ ì‹œì‘ ì‹œ ì´ˆê¸°í™”
            if (hardQuizWordPool.length === 0 && hardQuizRound === 1 && roundScores.length === 0) {
                hardQuizWordPool = [...words];
                hardQuizRound = 1;
                hardQuizScore = 0;
                hardQuizTotal = 0;
                roundScores = [];
                currentRoundWrongAnswers = [];
                showHardQuizRoundStart();
                return;
            }
            
            // ì‹¤ì œ í€´ì¦ˆ ë¬¸ì œ í‘œì‹œ
            showHardQuizQuestion();
        }

        // ë¼ìš´ë“œ ì‹œì‘ í™”ë©´ í‘œì‹œ
        function showHardQuizRoundStart() {
            let scoreDisplay = '';
            if (roundScores.length > 0) {
                const totalScore = roundScores.reduce((sum, round) => sum + round.score, 0);
                const totalQuestions = roundScores.reduce((sum, round) => sum + round.total, 0);
                
                scoreDisplay = `
                    <div class="bg-white bg-opacity-20 rounded-xl p-4 mb-4">
                        <h3 class="text-lg font-semibold mb-3">ğŸ“Š ì´ì „ ë¼ìš´ë“œ ê²°ê³¼</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm">
                            ${roundScores.map(round => 
                                `<div>ë¼ìš´ë“œ ${round.round}: ${round.score}/${round.total}ì </div>`
                            ).join('')}
                        </div>
                        <div class="mt-3 pt-3 border-t border-white border-opacity-30">
                            <div class="text-lg font-bold">ì´ì : ${totalScore}/${totalQuestions}ì  (${Math.round(totalScore/totalQuestions*100)}%)</div>
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('hardQuizContent').innerHTML = `
                <div class="text-center">
                    <div class="bg-gradient-to-r from-purple-500 to-indigo-600 text-white rounded-2xl p-8 mb-8">
                        <h2 class="text-4xl font-bold mb-4">ğŸ¯ ë¼ìš´ë“œ ${hardQuizRound}</h2>
                        <p class="text-xl mb-2">ì´ ${words.length}ê°œì˜ ë‹¨ì–´ë¥¼ í•™ìŠµí•©ë‹ˆë‹¤</p>
                        ${scoreDisplay}
                        <p class="text-lg opacity-90">ì¤€ë¹„ë˜ì…¨ë‚˜ìš”?</p>
                    </div>
                    <button onclick="showHardQuizQuestion()" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold py-4 px-12 rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all transform hover:scale-105 shadow-lg text-xl">
                        ğŸš€ Start!
                    </button>
                </div>
            `;
        }

        // ì‹¤ì œ í€´ì¦ˆ ë¬¸ì œ í‘œì‹œ
        function showHardQuizQuestion() {
            // ë¼ìš´ë“œê°€ ëë‚¬ëŠ”ì§€ í™•ì¸
            if (hardQuizWordPool.length === 0) {
                showRoundResult();
                return;
            }
            
            // ëœë¤í•˜ê²Œ ë‹¨ì–´ ì„ íƒí•˜ê³  í’€ì—ì„œ ì œê±°
            const randomIndex = Math.floor(Math.random() * hardQuizWordPool.length);
            currentHardQuizWord = hardQuizWordPool.splice(randomIndex, 1)[0];
            
            // ì˜ˆë¬¸ì—ì„œ ì •ë‹µ ë‹¨ì–´ë¥¼ ë¹ˆì¹¸ìœ¼ë¡œ ì²˜ë¦¬
            let processedExample = '';
            if (currentHardQuizWord.example) {
                const word = currentHardQuizWord.word;
                const regex = new RegExp(`\\b${word}\\b`, 'gi');
                processedExample = currentHardQuizWord.example.replace(regex, '_____');
            }
            
            document.getElementById('hardQuizContent').innerHTML = `
                <div class="text-center mb-8">
                    <div class="flex items-center justify-between mb-4">
                        <div class="text-sm text-gray-500">ë¼ìš´ë“œ ${hardQuizRound}</div>
                        <div class="text-sm text-gray-500">í˜„ì¬ ì ìˆ˜: ${hardQuizScore}/${hardQuizTotal}</div>
                        <div class="text-sm text-gray-500">ë‚¨ì€ ë¬¸ì œ: ${hardQuizWordPool.length + 1}</div>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-4">ë‹¤ìŒ ëœ»ì— í•´ë‹¹í•˜ëŠ” ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”:</h3>
                    <div class="bg-blue-50 p-6 rounded-xl mb-6">
                        <p class="text-xl text-gray-800 mb-3">${currentHardQuizWord.meaning}</p>
                        ${processedExample ? `<p class="text-gray-600"><em>ì˜ˆë¬¸: ${processedExample}</em></p>` : ''}
                    </div>
                    <input type="text" id="hardQuizInput" class="w-full p-4 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none text-center text-xl mb-6" placeholder="ë‹µì„ ì…ë ¥í•˜ì„¸ìš”">
                    <button onclick="checkHardAnswer()" class="bg-purple-500 text-white font-bold py-4 px-8 rounded-xl hover:bg-purple-600 transition-all">
                        âœ… ë‹µì•ˆ í™•ì¸
                    </button>
                </div>
                <div id="hardQuizResult" class="text-center mt-6"></div>
                <button onclick="continueQuiz()" class="w-full bg-purple-500 text-white font-bold py-4 px-8 rounded-xl hover:bg-purple-600 transition-all mt-6">
                    ğŸ”„ ë‹¤ìŒ ë¬¸ì œ
                </button>
            `;
            
            // ì…ë ¥ í•„ë“œì— í¬ì»¤ìŠ¤
            setTimeout(() => document.getElementById('hardQuizInput').focus(), 100);
        }

        // ì£¼ê´€ì‹ ë‹µì•ˆ í™•ì¸
        function checkHardAnswer() {
            const userAnswer = document.getElementById('hardQuizInput').value.trim().toLowerCase();
            const correctAnswer = currentHardQuizWord.word.toLowerCase();
            const result = document.getElementById('hardQuizResult');
            
            // ì ìˆ˜ ì—…ë°ì´íŠ¸
            hardQuizTotal++;
            if (userAnswer === correctAnswer) {
                hardQuizScore++;
                result.innerHTML = '<div class="text-green-600 font-bold text-xl">ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!</div>';
            } else {
                // ì˜¤ë‹µ ì €ì¥
                currentRoundWrongAnswers.push({
                    word: currentHardQuizWord.word,
                    meaning: currentHardQuizWord.meaning,
                    userAnswer: document.getElementById('hardQuizInput').value.trim(),
                    example: currentHardQuizWord.example
                });
                result.innerHTML = `<div class="text-red-600 font-bold text-xl">âŒ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”<br><small class="text-gray-600">ì •ë‹µ: ${currentHardQuizWord.word}</small></div>`;
            }
            
            // í˜„ì¬ ì ìˆ˜ ì—…ë°ì´íŠ¸ í‘œì‹œ
            const scoreElement = document.querySelector('.text-sm.text-gray-500:nth-child(2)');
            if (scoreElement) {
                scoreElement.textContent = `í˜„ì¬ ì ìˆ˜: ${hardQuizScore}/${hardQuizTotal}`;
            }
            
            // ë‹µì•ˆ í™•ì¸ í›„ ì •ë‹µ ë‹¨ì–´ ë°œìŒ
            setTimeout(() => {
                speakWord(currentHardQuizWord.word);
            }, 500);
        }

        // í€´ì¦ˆ ê³„ì†í•˜ê¸°
        function continueQuiz() {
            showHardQuizQuestion();
        }

        // ë¼ìš´ë“œ ê²°ê³¼ í‘œì‹œ
        function showRoundResult() {
            // í˜„ì¬ ë¼ìš´ë“œ ì ìˆ˜ ì €ì¥
            roundScores.push({
                round: hardQuizRound,
                score: hardQuizScore,
                total: hardQuizTotal,
                wrongAnswers: [...currentRoundWrongAnswers]
            });
            
            // ì‚¬ìš©ì ë°ì´í„° ì €ì¥
            saveUserData();
            
            const accuracy = Math.round((hardQuizScore / hardQuizTotal) * 100);
            const totalScore = roundScores.reduce((sum, round) => sum + round.score, 0);
            const totalQuestions = roundScores.reduce((sum, round) => sum + round.total, 0);
            const overallAccuracy = Math.round((totalScore / totalQuestions) * 100);
            
            let wrongAnswersDisplay = '';
            if (currentRoundWrongAnswers.length > 0) {
                wrongAnswersDisplay = `
                    <div class="bg-red-50 border border-red-200 rounded-xl p-6 mb-6">
                        <h4 class="text-lg font-bold text-red-800 mb-4">âŒ í‹€ë¦° ë¬¸ì œ ë³µìŠµ</h4>
                        <div class="space-y-4">
                            ${currentRoundWrongAnswers.map(wrong => `
                                <div class="bg-white p-4 rounded-lg border border-red-100">
                                    <div class="flex items-center gap-3 mb-2">
                                        <span class="font-bold text-red-600">${wrong.word}</span>
                                        <button onclick="speakWord('${wrong.word}')" class="bg-red-100 hover:bg-red-200 text-red-600 p-1 rounded transition-all text-sm">ğŸ”Š</button>
                                    </div>
                                    <p class="text-gray-700 mb-1"><strong>ëœ»:</strong> ${wrong.meaning}</p>
                                    <p class="text-red-600 text-sm"><strong>ë‹¹ì‹ ì˜ ë‹µ:</strong> ${wrong.userAnswer || '(ë‹µ ì—†ìŒ)'}</p>
                                    ${wrong.example ? `<p class="text-gray-600 text-sm mt-2"><strong>ì˜ˆë¬¸:</strong> ${wrong.example}</p>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            document.getElementById('hardQuizContent').innerHTML = `
                <div class="text-center">
                    <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-2xl p-8 mb-8">
                        <h2 class="text-4xl font-bold mb-4">ğŸ‰ ë¼ìš´ë“œ ${hardQuizRound} ì™„ë£Œ!</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                            <div class="bg-white bg-opacity-20 rounded-xl p-4">
                                <h3 class="text-lg font-semibold mb-2">ì´ë²ˆ ë¼ìš´ë“œ</h3>
                                <p class="text-2xl font-bold">${hardQuizScore}/${hardQuizTotal}ì </p>
                                <p class="text-lg">ì •í™•ë¥ : ${accuracy}%</p>
                            </div>
                            <div class="bg-white bg-opacity-20 rounded-xl p-4">
                                <h3 class="text-lg font-semibold mb-2">ì „ì²´ ê¸°ë¡</h3>
                                <p class="text-2xl font-bold">${totalScore}/${totalQuestions}ì </p>
                                <p class="text-lg">ì •í™•ë¥ : ${overallAccuracy}%</p>
                            </div>
                        </div>
                    </div>
                    
                    ${wrongAnswersDisplay}
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <button onclick="startNextRound()" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold py-4 px-8 rounded-xl hover:from-green-600 hover:to-emerald-700 transition-all transform hover:scale-105 shadow-lg">
                            ğŸš€ ë‹¤ìŒ ë¼ìš´ë“œ ì‹œì‘
                        </button>
                        <button onclick="resetQuiz()" class="bg-gradient-to-r from-gray-500 to-gray-600 text-white font-bold py-4 px-8 rounded-xl hover:from-gray-600 hover:to-gray-700 transition-all transform hover:scale-105 shadow-lg">
                            ğŸ”„ í€´ì¦ˆ ë‹¤ì‹œ ì‹œì‘
                        </button>
                    </div>
                </div>
            `;
        }

        // ë‹¤ìŒ ë¼ìš´ë“œ ì‹œì‘
        function startNextRound() {
            hardQuizRound++;
            hardQuizScore = 0;
            hardQuizTotal = 0;
            currentRoundWrongAnswers = [];
            hardQuizWordPool = [...words];
            showHardQuizRoundStart();
        }

        // í€´ì¦ˆ ë¦¬ì…‹
        function resetQuiz() {
            hardQuizRound = 1;
            hardQuizScore = 0;
            hardQuizTotal = 0;
            roundScores = [];
            currentRoundWrongAnswers = [];
            hardQuizWordPool = [];
            
            document.getElementById('hardQuizContent').innerHTML = `
                <p class="text-gray-500 text-center py-8">ê³ ê¸‰ í€´ì¦ˆë¥¼ ì‹œì‘í•˜ë ¤ë©´ ìµœì†Œ 1ê°œì˜ ë‹¨ì–´ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
                <button onclick="startHardQuiz()" class="w-full bg-purple-500 text-white font-bold py-4 px-8 rounded-xl hover:bg-purple-600 transition-all transform hover:scale-105 shadow-lg">
                    ğŸ§  ê³ ê¸‰ í€´ì¦ˆ ì‹œì‘í•˜ê¸°
                </button>
            `;
        }

        // ë¡œê·¸ì¸ í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                showMessage('ì‚¬ìš©ìëª…ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            const result = loginUser(username, password);
            if (result.success) {
                document.getElementById('loginModal').classList.add('hidden');
                showMessage('ë¡œê·¸ì¸ ì„±ê³µ! ğŸ‰', 'success');
                
                // ì–¸ì–´ ì„ íƒ ëª¨ë‹¬ í‘œì‹œ (ì–¸ì–´ê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš°)
                if (!currentLanguage) {
                    document.getElementById('languageModal').classList.remove('hidden');
                }
            } else {
                document.getElementById('loginMessage').textContent = result.message;
                document.getElementById('loginMessage').className = 'mt-4 text-center text-sm text-red-500';
            }
        });

        // íšŒì›ê°€ì… í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('registerUsername').value.trim();
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
            
            if (!username || !password || !passwordConfirm) {
                showMessage('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            if (password !== passwordConfirm) {
                showMessage('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            const result = registerUser(username, password);
            if (result.success) {
                document.getElementById('registerModal').classList.add('hidden');
                showMessage('íšŒì›ê°€ì… ì„±ê³µ! ì´ì œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.', 'success');
                showLoginForm();
                
                // í¼ ì´ˆê¸°í™”
                document.getElementById('registerForm').reset();
            } else {
                document.getElementById('registerMessage').textContent = result.message;
                document.getElementById('registerMessage').className = 'mt-4 text-center text-sm text-red-500';
            }
        });

        // ì‚¬ìš©ìëª… ì¤‘ë³µ ì²´í¬ (ì‹¤ì‹œê°„)
        document.getElementById('registerUsername').addEventListener('input', function() {
            const username = this.value.trim();
            const checkElement = document.getElementById('usernameCheck');
            
            if (username.length === 0) {
                checkElement.textContent = '';
                checkElement.className = 'text-xs mt-1';
            } else if (username.length < 3) {
                checkElement.textContent = 'ì‚¬ìš©ìëª…ì€ 3ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.';
                checkElement.className = 'text-xs mt-1 text-orange-500';
            } else if (checkUsernameAvailability(username)) {
                checkElement.textContent = 'âœ… ì‚¬ìš© ê°€ëŠ¥í•œ ì‚¬ìš©ìëª…ì…ë‹ˆë‹¤.';
                checkElement.className = 'text-xs mt-1 text-green-500';
            } else {
                checkElement.textContent = 'âŒ ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì‚¬ìš©ìëª…ì…ë‹ˆë‹¤.';
                checkElement.className = 'text-xs mt-1 text-red-500';
            }
        });

        // ì—”í„°í‚¤ë¡œ ë‹µì•ˆ í™•ì¸
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && document.getElementById('hardQuizInput') && document.activeElement === document.getElementById('hardQuizInput')) {
                checkHardAnswer();
            }
        });

        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `fixed top-4 right-4 p-4 rounded-xl shadow-lg z-50 fade-in ${
                type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
            }`;
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }
    </script>
</body>
</html>
